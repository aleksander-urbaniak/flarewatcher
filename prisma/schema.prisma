datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "debian-openssl-1.1.x"]
}

model DnsUpdate {
  id        String   @id @default(cuid())
  zoneId    String
  tokenId   String?
  recordId  String
  name      String
  type      String
  previousContent String?
  previousTtl Int?
  previousProxied Boolean?
  content   String
  ttl       Int
  proxied   Boolean
  comment   String?
  status    String
  trigger   String
  actor     String?
  propagated Boolean?
  propagationNote String?
  response  String
  createdAt DateTime @default(now())
}

model User {
  id           String    @id @default(cuid())
  username     String
  email        String    @unique
  passwordHash String
  isAdmin      Boolean   @default(false)
  twoFactorEnabled Boolean @default(false)
  twoFactorSecret  String?
  twoFactorTempSecret String?
  createdAt    DateTime  @default(now())
  sessions     Session[]
  settings     UserSettings?
  tokens       CloudflareToken[]
  auditEvents  AuditEvent[]
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model UserSettings {
  id               String   @id @default(cuid())
  userId           String   @unique
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  intervalMinutes  Int      @default(5)
  monitoredRecords Json     @default("[]")
  alertEmail       String?
  telegramBotToken String?
  telegramChatId   String?
  discordWebhookUrl String?
  discordMarkdown  String?
  discordEnabled   Boolean  @default(true)
  smtpHost         String?
  smtpPort         Int?
  smtpUser         String?
  smtpPass         String?
  smtpFrom         String?
  smtpTo           String?
  smtpMessage      String?
  smtpEnabled      Boolean  @default(true)
  notifyOnIpChange Boolean  @default(true)
  notifyOnFailure  Boolean  @default(true)
  updatedAt        DateTime @updatedAt
}

model CloudflareToken {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  token     String
  status    String
  scopes    Json     @default("[]")
  missingScopes Json @default("[]")
  lastCheckedAt DateTime @default(now())
  createdAt DateTime @default(now())
}

model AuditEvent {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  action     String
  targetType String?
  targetId   String?
  detail     Json?
  createdAt  DateTime @default(now())
}
